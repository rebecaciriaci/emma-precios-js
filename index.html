<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EMMA Refrigeraci√≥n - Lista de Precios online</title>
    <style>
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body { 
            font-family: 'Segoe UI', Arial, sans-serif; 
            background: #f5f5f5; 
            padding: 20px;
            max-width: 1000px;
            margin: 0 auto;
        }
        .header { 
            background: #dc2626; 
            color: white; 
            padding: 20px; 
            border-radius: 10px;
            text-align: center;
            margin-bottom: 20px;
        }
        .search-container {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        #buscador {
            width: 100%;
            padding: 15px;
            border: 2px solid #ddd;
            border-radius: 25px;
            font-size: 16px;
            outline: none;
        }
        #buscador:focus {
            border-color: #3498db;
        }
        #resultados {
            display: grid;
            gap: 10px;
        }
        .producto {
            background: white;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            border-left: 4px solid #3498db;
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            gap: 15px;
        }
        .producto-info {
            flex: 1;
        }
        .producto .descripcion {
            font-weight: bold;
            font-size: 16px;
            margin-bottom: 8px;
            color: #2c3e50; /* Negro para productos con stock */
        }
        .sin-stock .descripcion {
            color: #5d6d7e; /* Gris mas claro para productos sin stock */
        }
        .stock-bajo .descripcion {
            color: #2d3748; /* Gris para stock bajo */
        }
        .producto .codigo {
            color: #7f8c8d;
            font-family: monospace;
            font-size: 13px;
            margin-bottom: 5px;
        }
        .producto-precios {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            min-width: 250px;
        }
        .precio-columna {
            text-align: center;
            padding: 8px;
            border-radius: 6px;
        }
        .precio-cliente-container {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
        }
        .precio-tecnico-container {
            background: #fff3e0;
            border: 1px solid #ffe0b2;
        }
        .precio-cliente {
            color: #27ae60;
            font-weight: bold;
            font-size: 16px;
            margin-bottom: 3px;
        }
        .precio-tecnico {
            color: #e67e22;
            font-weight: bold;
            font-size: 16px;
            margin-bottom: 3px;
        }
        .etiqueta-precio {
            font-size: 11px;
            color: #7f8c8d;
            text-transform: uppercase;
            margin-bottom: 5px;
            font-weight: bold;
        }
        .diferencia-precio {
            font-size: 11px;
            color: #95a5a6;
            margin-top: 8px;
            padding-top: 8px;
            border-top: 1px solid #ecf0f1;
            grid-column: 1 / span 2;
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 15px;
        }
        .producto .stock {
            color: #e74c3c;
            font-size: 12px;
            font-weight: bold;
            margin-top: 8px;
        }
        .stock-info {
            margin-top: 8px;
        }
        .contador {
            text-align: center;
            color: #7f8c8d;
            margin: 20px 0;
            font-style: italic;
        }
        .status {
            text-align: center;
            padding: 20px;
            border-radius: 8px;
            margin: 10px 0;
        }
        .success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .sin-stock {
            opacity: 0.7;
            border-left-color: #e74c3c;
        }
        .stock-bajo {
            border-left-color: #f39c12;
        }
        .ahorro-porcentaje {
            color: #2ecc71;
            font-weight: bold;
        }
        .ahorro-monto {
            color: #27ae60;
            font-weight: bold;
        }
        .ultima-actualizacion {
            font-size: 12px;
            margin-top: 10px;
            opacity: 0.9;
        }
        .auto-update-indicator {
            font-size: 10px;
            color: #95a5a6;
            margin-top: 5px;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>EMMA Refrigeraci√≥n</h1>
        <p>Lista de Precios online</p>
        <div class="ultima-actualizacion" id="ultima-actualizacion">
            √öltima actualizaci√≥n: <span id="fecha-actualizacion">-</span>
        </div>
        <div class="auto-update-indicator">
            üîÑ Actualizaci√≥n autom√°tica cada 30 segundos
        </div>
    </div>

    <div class="search-container">
        <input type="text" id="buscador" placeholder="üîç Escribe para buscar productos (ej: 'aire', 'motor', '4-2-5412')..." autocomplete="off">
    </div>

    <div class="contador" id="contador">Mostrando <span id="cantidad">0</span> productos de <span id="total">0</span></div>
    
    <div id="resultados">
        <div class="status" id="status">üîÑ Cargando productos...</div>
    </div>

    <!-- Cargar el JavaScript -->
    <script src="https://rebecaciriaci.github.io/emma-precios-js/lista_precios.js"></script>

    <script>
        let productosOriginales = [];
        let intervaloActualizacion;

        // Funci√≥n principal - versi√≥n simple y funcional
        function inicializarApp() {
            console.log('üîß Inicializando aplicaci√≥n...');
            
            // Verificar si se carg√≥ la variable productos
            if (typeof productos === 'undefined') {
                mostrarError('No se pudo cargar lista_precios.js. Verifica que el archivo est√© disponible.');
                return;
            }

            if (!productos || productos.length === 0) {
                mostrarError('El archivo se carg√≥ pero est√° vac√≠o o no tiene datos.');
                return;
            }

            // Guardar copia de los productos originales para comparar cambios
            productosOriginales = JSON.parse(JSON.stringify(productos));
            
            console.log('‚úÖ Productos cargados:', productos.length);
            mostrarExito(`${productos.length} productos cargados correctamente`);
            
            // Actualizar fecha y hora de la √∫ltima actualizaci√≥n
            actualizarFecha();
            
            document.getElementById('total').textContent = productos.length;
            
            // Configurar b√∫squeda
            document.getElementById('buscador').addEventListener('input', buscarProductos);
            buscarProductos(); // Mostrar todos al inicio
            
            // Iniciar actualizador autom√°tico cada 30 segundos
            iniciarActualizadorAutomatico();
        }

        function iniciarActualizadorAutomatico() {
            console.log('üîÑ Iniciando actualizador autom√°tico cada 30 segundos...');
            intervaloActualizacion = setInterval(verificarActualizacion, 30000); // 30 segundos
        }

        function verificarActualizacion() {
            const viejoScript = document.getElementById('productos-script');
            if (viejoScript) viejoScript.remove();

            const script = document.createElement('script');
            script.id = 'productos-script';
            script.src = `https://rebecaciriaci.github.io/emma-precios-js/lista_precios.js?t=${Date.now()}`;

            script.onload = () => {
                if (typeof productos !== 'undefined') {
                    const hayCambios =
                        JSON.stringify(productos) !== JSON.stringify(productosOriginales);

                    if (hayCambios) {
                        productosOriginales = JSON.parse(JSON.stringify(productos));
                        actualizarFecha();
                        document.getElementById('total').textContent = productos.length;
                        buscarProductos();
                        mostrarNotificacion('Precios actualizados autom√°ticamente');
                    }
                }
            };

            document.head.appendChild(script);
        }


        function actualizarFecha() {
            const fechaActualizacion = new Date().toLocaleString('es-AR');
            document.getElementById('fecha-actualizacion').textContent = fechaActualizacion;
        }

        function mostrarNotificacion(mensaje) {
            const status = document.getElementById('status');
            status.className = 'status success';
            status.innerHTML = '‚úÖ ' + mensaje;
            status.style.display = 'block';
            
            setTimeout(() => {
                status.style.display = 'none';
            }, 3000);
        }

        function mostrarError(mensaje) {
            document.getElementById('status').className = 'status error';
            document.getElementById('status').innerHTML = '‚ùå ' + mensaje;
        }

        function mostrarExito(mensaje) {
            document.getElementById('status').className = 'status success';
            document.getElementById('status').innerHTML = '‚úÖ ' + mensaje;
            setTimeout(() => {
                document.getElementById('status').style.display = 'none';
            }, 3000);
        }

        function buscarProductos() {
            const query = document.getElementById('buscador').value.toLowerCase().trim();
            
            let resultados = productos;
            
            if (query) {
                resultados = productos.filter(p => {
                    return p.Producto.toLowerCase().includes(query) || 
                           p.Codigo.toLowerCase().includes(query);
                });
            }
            
            resultados.sort((a, b) => a.Producto.localeCompare(b.Producto));
            mostrarResultados(resultados);
        }

        function mostrarResultados(productosFiltrados) {
            const contenedor = document.getElementById('resultados');
            const contador = document.getElementById('cantidad');
            
            contador.textContent = productosFiltrados.length;
            
            if (productosFiltrados.length === 0) {
                const query = document.getElementById('buscador').value;
                if (query) {
                    contenedor.innerHTML = '<div class="status error">No se encontraron productos para: "' + query + '"</div>';
                } else {
                    contenedor.innerHTML = '<div class="status error">No hay productos para mostrar</div>';
                }
                return;
            }
            
            contenedor.innerHTML = productosFiltrados.map(producto => {
                const diferencia = producto.Precio_Cliente - producto.Precio_Tecnico;
                const porcentajeAhorro = ((diferencia / producto.Precio_Cliente) * 100).toFixed(1);
                
                // Determinar clase CSS seg√∫n stock
                let claseStock = '';
                if (producto.Cantidad_Stock === 0) {
                    claseStock = 'sin-stock';
                } else if (producto.Cantidad_Stock <= 5) {
                    claseStock = 'stock-bajo';
                }
                
                return `
                <div class="producto ${claseStock}">
                    <div class="producto-info">
                        <div class="descripcion">${producto.Producto}</div>
                        <div class="codigo">C√≥digo: ${producto.Codigo}</div>
                        <div class="stock-info">
                            ${producto.Cantidad_Stock === 0 ? 
                                '<span class="stock">SIN STOCK</span>' : 
                                producto.Cantidad_Stock <= 5 ? 
                                `<span class="stock">STOCK BAJO: ${producto.Cantidad_Stock}</span>` :
                                `<span style="color: #27ae60; font-size: 12px;">STOCK: ${producto.Cantidad_Stock}</span>`
                            }
                        </div>
                    </div>
                    
                    <div class="producto-precios">
                        <div class="precio-columna precio-cliente-container">
                            <div class="etiqueta-precio">Precio Cliente</div>
                            <div class="precio-cliente">$${producto.Precio_Cliente.toLocaleString('es-AR', {minimumFractionDigits: 2})}</div>
                        </div>
                        
                        <div class="precio-columna precio-tecnico-container">
                            <div class="etiqueta-precio">Precio T√©cnico</div>
                            <div class="precio-tecnico">$${producto.Precio_Tecnico.toLocaleString('es-AR', {minimumFractionDigits: 2})}</div>
                        </div>
                        
                        <div class="diferencia-precio">
                            <span class="ahorro-porcentaje">Diferencia: ${porcentajeAhorro}%</span>
                            <span class="ahorro-monto">$${diferencia.toLocaleString('es-AR', {minimumFractionDigits: 2})}</span>
                        </div>
                    </div>
                </div>
                `;
            }).join('');
        }

        // Inicializar cuando est√© listo
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', inicializarApp);
        } else {
            inicializarApp();
        }
    </script>
</body>
</html>